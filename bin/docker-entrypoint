#!/bin/bash
set -e

# Docker entrypoint script para produÃ§Ã£o

echo "ğŸš€ Iniciando aplicaÃ§Ã£o..."

# Log da configuraÃ§Ã£o do banco em produÃ§Ã£o
if [ "$RAILS_ENV" = "production" ]; then
  echo "ğŸ” Database URL configurada"
  echo "ğŸŒ Port: ${PORT:-3000}"
  echo "âœ… Iniciando aplicaÃ§Ã£o Rails..."
fi

# Se o comando for o rails server, adicionar a porta dinamicamente
if [ "${1}" == "bundle" ] && [ "${2}" == "exec" ] && [ "${3}" == "rails" ] && [ "${4}" == "server" ]; then
  set -- "$1" "$2" "$3" "$4" "-p" "${PORT:-3000}" "${@:5}"
fi

# If running the rails server then create or migrate existing database
if [ "${1}" == "./bin/rails" ] && [ "${2}" == "server" ]; then
  if [ "$RAILS_ENV" != "production" ]; then
    ./bin/rails db:prepare
  fi
fi

# Executar comando passado para o container
echo "ğŸ¯ Executando: $@"
exec "${@}"
